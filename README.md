# SNSUS - Social Media App Server (BE)

## Built With

- [TypeScript](https://www.typescriptlang.org/)
- [ExpressJS](https://expressjs.com/)
- [Routing Controllers](https://www.npmjs.com/package/routing-controllers)
- [JsonWebToken](https://www.npmjs.com/package/jsonwebtoken)
- [Bcrypt](https://www.npmjs.com/package/bcrypt)
- [Class Validator](https://www.npmjs.com/package/class-validator)
- [KnexJS](https://knexjs.org/)
- [MySQL](https://www.mysql.com/)
- [Winston](https://nodei.co/npm/winston/)
- [Nodemailer](https://nodemailer.com/about/)

## API Documentaion

All API requests require the use of generated **API key** and user restricted requests require **HTTP cookie**.

### Authentication 

```http
POST /login

{
"username": "foo",
"password": "1234"
}
```

| Body Param | Type | Description |
| :--- | :--- | :--- |
| username | `string` | **Required**. User username |
| password | `string` | **Required**. User password |

Send login credentials to receive access token as HTTP Only Cookie from server.

```http
POST /authToken
```

Check if access token is valid by checking browser cookie.

### Sign Up

```http
GET /signup/verify?token=
```

| Query Param | Type | Description |
| :--- | :--- | :--- |
| token | `string` | **Required**. Token containing user information. MUST BE in format of JSON web token. |

Handle user sign up through token previously generated by server. User Id is generated automatically upon creation.

### E-Mail Service

```http
POST /mail/signup

{
"username": "foo",
"password": "1234",
"email": "foo@fakeemail.com"
...
}
```

| Body Param | Type | Description |
| :--- | :--- | :--- |
| username | `string` | **Required**. User username |
| password | `string` | **Required**. User password |
| email | `string` | **Required**. User e-mail. MUST BE in the format of an email address |

Generate request url from user information and send to user's e-mail to finsh sign up process.

### Post

```http
GET /posts/:userId
```

| Path Param | Type | Description |
| :--- | :--- | :--- |
| userId | `string` | **Required**. User identification value.  |

Retrieve all posts written by user with provided user identification.

```http
POST /posts/:userId
```

| Path Param | Type | Description |
| :--- | :--- | :--- |
| userId | `string` | **Required**. User identification value.  |

| Body Param | Type | Description |
| :--- | :--- | :--- |
| content | `string` | **Required**. Post content  |

Save post in data base. Post ID and created time generated automatically upon save.

```http
PATCH /posts/:userId/:postId
```

| Path Param | Type | Description |
| :--- | :--- | :--- |
| userId | `string` | **Required**. User identification value.  |
| postId | `string` | **Required**. Post identification value.  |

| Body Param | Type | Description |
| :--- | :--- | :--- |
| content | `string` | **Required**. Updated Post content  |

Update post in data base. Update time generated automatically upon update.

```http
DELETE /posts/:userId/:postId
```

| Path Param | Type | Description |
| :--- | :--- | :--- |
| userId | `string` | **Required**. User identification value.  |
| postId | `string` | **Required**. Post identification value.  |

Delete post from data base.


## Project Todo List

### Database

âœ… Establish connection to MySQL database  
âœ… Implement data queries with Knex  

### Security

âœ… Cors implementation  
âœ… Encryption Utility (aes-256-gcm)  
âœ… JWT Token Implementation for HTTP Only Cookie  
âœ… API Key utility (verified with every request)  

### Login

âœ… Enable password verification with Bcrypt  
âœ… Generate access token (set-cookie to client)  

### Sign Up

âœ… Send confirmation email  
âœ… Sign up user

### Post

âœ… CRUD posts  
ðŸ”² Like/unlike posts  
ðŸ”² CRUD comments  

### Common

âœ… Logger implementation with winston  

### Deployment

âœ… Containerize with Docker  
âœ… Configure Nginx for HTTPS support  

## Data Modeling

### User, Post, Comment

<img src="src/assets/datamodel.png" alt="prev1" width="500px"/>


