# SNSUS - Social Media App Server (BE)

## Built With

- [TypeScript](https://www.typescriptlang.org/)
- [ExpressJS](https://expressjs.com/)
- [Routing Controllers](https://www.npmjs.com/package/routing-controllers)
- [JsonWebToken](https://www.npmjs.com/package/jsonwebtoken)
- [Bcrypt](https://www.npmjs.com/package/bcrypt)
- [Class Validator](https://www.npmjs.com/package/class-validator)
- [KnexJS](https://knexjs.org/)
- [MySQL](https://www.mysql.com/)
- [Winston](https://nodei.co/npm/winston/)
- [Nodemailer](https://nodemailer.com/about/)

## API Documentaion

All API requests require the use of generated **API key** and user restricted requests require **HTTP cookie**.

### Authentication

```http
POST /login

{
"username": "foo",
"password": "1234"
}
```

| Body Param | Type     | Description                 |
| :--------- | :------- | :-------------------------- |
| username   | `string` | **Required**. User username |
| password   | `string` | **Required**. User password |

Send login credentials to receive access token as HTTP Only Cookie from server.

```http
POST /authToken
```

Check if access token is valid by checking browser cookie.

### Sign Up

```http
GET /signup/verify?token=
```

| Query Param | Type     | Description                                                                           |
| :---------- | :------- | :------------------------------------------------------------------------------------ |
| token       | `string` | **Required**. Token containing user information. MUST BE in format of JSON web token. |

Handle user sign up through token previously generated by server. User Id is generated automatically upon creation.

### E-Mail Service

```http
POST /mail/signup

{
"username": "foo",
"password": "1234",
"email": "foo@fakeemail.com"
...
}
```

| Body Param | Type     | Description                                                          |
| :--------- | :------- | :------------------------------------------------------------------- |
| username   | `string` | **Required**. User username                                          |
| password   | `string` | **Required**. User password                                          |
| email      | `string` | **Required**. User e-mail. MUST BE in the format of an email address |

Generate request url from user information and send to user's e-mail to finsh sign up process.

### Post

```http
GET /posts/:userId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |

Retrieve all posts written by user with provided user identification.

```http
POST /posts/:userId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |

| Body Param | Type     | Description                |
| :--------- | :------- | :------------------------- |
| content    | `string` | **Required**. Post content |

Save post in data base. Post ID and created time generated automatically upon save.

```http
PATCH /posts/:userId/:postId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |
| postId     | `string` | **Required**. Post identification value. |

| Body Param | Type     | Description                        |
| :--------- | :------- | :--------------------------------- |
| content    | `string` | **Required**. Updated Post content |

Update post in data base. Update time generated automatically upon update.

```http
DELETE /posts/:userId/:postId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |
| postId     | `string` | **Required**. Post identification value. |

Delete post from database.

### Comment

```http
GET /comment/:postId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| postId     | `string` | **Required**. Post identification value. |

Retrieve all comments related to specific post.

```http
POST /comment/:postId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| postId     | `string` | **Required**. Post identification value. |

| Body Param | Type     | Description                   |
| :--------- | :------- | :---------------------------- |
| content    | `string` | **Required**. Comment content |

Save comment in database. Comment ID and created time generated automatically upon save. Commenting user is automatically identified through authentication token verification.

```http
DELETE /comment/:postId/:userId/:commentId
```

| Path Param | Type     | Description                                 |
| :--------- | :------- | :------------------------------------------ |
| userId     | `string` | **Required**. User identification value.    |
| postId     | `string` | **Required**. Post identification value.    |
| commentId  | `string` | **Required**. Comment identification value. |

Delete comment from data base.

### Friend

```http
GET /friend/:userId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |

Retrieve all friends' User data of specific user.

```http
GET /friend/all/:userId
```

| Path Param | Type     | Description                              |
| :--------- | :------- | :--------------------------------------- |
| userId     | `string` | **Required**. User identification value. |

Retrieve all friendship relation data (both pending requests and accepted friendships) of specific user.

```http
POST /friend
```

| Body Param  | Type     | Description                                           |
| :---------- | :------- | :---------------------------------------------------- |
| requesterId | `string` | **Required**. User ID of a user requesting friendship |
| addresseeId | `string` | **Required**. User ID of user addressed for request   |

Save friendship request in database. Permission checked through auth token match with requester ID.

```http
PATCH /friend
```

| Body Param  | Type     | Description                                                    |
| :---------- | :------- | :------------------------------------------------------------- |
| requesterId | `string` | **Required**. User ID of a user requesting friendship          |
| addresseeId | `string` | **Required**. User ID of user addressed for request            |
| statusCode  | `string` | **Required**. Status of selected friendship data to be updated |

Update friendship data in database. Ability to update status to "ACCEPTED" will only be allowed by user that matches "addresseeId". Both requester and addressee may update status to "DENIED" or "BLOCKED".

## Project Todo List

### Database

✅ Establish connection to MySQL database  
✅ Implement data queries with Knex

### Security

✅ Cors implementation  
✅ Encryption Utility (aes-256-gcm)  
✅ JWT Token Implementation for HTTP Only Cookie  
✅ API Key utility (verified with every request)

### Login

✅ Enable password verification with Bcrypt  
✅ Generate access token (set-cookie to client)

### Sign Up

✅ Send confirmation email  
✅ Sign up user

### Post

✅ CRUD posts  
✅ Like/unlike posts  
✅ CRUD comments

### Common

✅ Logger implementation with winston

### Deployment

✅ Containerize with Docker  
✅ Configure Nginx for HTTPS support

## Data Modeling

<img src="src/assets/datamodel.png" alt="prev1" width="500px"/>
